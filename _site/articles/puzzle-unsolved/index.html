<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>一个尚未解决的问题</title>
  <meta name="description" content="正确的标题不应该是这样的，但是由于此问题尚未解决，不知道该起什么名字好。:)">

  <link rel="stylesheet" href="/assets/css/highlight.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link href='http://fonts.googleapis.com/css?family=Raleway|PT+Serif' rel='stylesheet' type='text/css'>
</head>


<body>
<nav id="site-nav" class=" ">
    <ul>
        <li>
            <a href="/" class="tooltip">
                <span class="iconfont icon-home"></span>
                <span>Home</span>
            </a>

        </li>
        <li>
            <a href="/category/article" class="tooltip">
                <span class="iconfont icon-article"></span>
                <span>Technique</span>
            </a>

        </li>
        <li>
            <a href="/category/life" class="tooltip">
                <span class="iconfont icon-camera"></span>
                <span>Life</span>
            </a>

        </li>
        <li>
            <a href="/about" class="tooltip">
                <span class="iconfont icon-user"></span>
                <span>About me</span>
            </a>

        </li>
    </ul>
</nav>
  <div class="post">
    <div class="wrapper">
      <header class="post-header">
        <h1 class="post-title">一个尚未解决的问题</h1>
        
        <p class="post-meta">Mar 11, 2015</p>
        
      </header>
      <article class="post-content">
        <div class="tag-panel">
  <span class="entry-tags">
      <span style="font-family:pt serif;font-style: italic">Tags:&nbsp;&nbsp;</span>
      
        <a href="/tags/#HTTP" title="Pages tagged HTTP" class="tag">HTTP</a>
      
        <a href="/tags/#字体" title="Pages tagged 字体" class="tag">字体</a>
      
        <a href="/tags/#浏览器" title="Pages tagged 浏览器" class="tag">浏览器</a>
      
  </span>
</div>
<div class="post">
  <article class="post-content">
    <div class="text-info">正确的标题不应该是这样的，但是由于此问题尚未解决，不知道该起什么名字好。:)</div>

<p>起因是某日搜东西的跳到搜狗问问页面，字体混乱地无力吐槽。如下图：
<figure>
    <img src="http://7sbqpj.com1.z0.glb.clouddn.com/sogou.png" alt="搜狗问问首页侧栏">
    <figcaption>Chrome下搜狗问问首页侧栏</figcaption>
</figure></p>

<p>再查看渲染字体，把我一惊，居然有日文字体。可是明明样式里字体设置<code>font-family: Tahoma,Arial,Helvetica,sans-serif,SimSun;</code>除了把宋体错
误地写在最后以外，并没有什么地方设置了日文字体啊。而且，除了<code>html</code>标签未设置lang属性外，也没有什么问题啊。
<figure>
    <img src="http://7sbqpj.com1.z0.glb.clouddn.com/rendered-fonts.png " alt="Rendered fonts">
    <figcaption>Chrome下该页面的渲染字体</figcaption>
</figure></p>

<p>一个月后才发现：原来是Chrome的设置问题啊！因为Safari和FireFox没有这个问题啊！(T_T)。刚好那时候学了一点HTTP方面的知识，发现：原来Chrome
下网页的HTTP response header的content-language为ja。而FireFox为en-us,Safari为zh-cn。所以，Chrome下会出现日文字体不足为奇啊。同时
发现，出现这个问题的不仅仅是搜狗问问，还有丁香园。以及后来发现的，支付宝支付页面。可是，又是什么原因导致响应头的content-language为ja呢？
为什么查看别的正常的网页的响应头里不会有content-language信息呢？
<figure>
    <img src="http://7sbqpj.com1.z0.glb.clouddn.com/res-header.png" alt="Content-language information">
    <figcaption>Chrome下该网页的响应头部信息</figcaption>
</figure></p>

<p>一段时间我都认为是Google account的缘故，因为在Chrome登录的Google account是在日本实习的时候注册的，信息什么的都以在日实习信息为准。而且
切换账号后，content-language为zh-cn。</p>

<p>直到今天才发现，原来在Chrome语言设置里，日文被我稀里糊涂地排在了首位！尝试了下在FF下，设置语言为日文时，搜狗问问的字体也是混乱的。至此，应
该可以得出结论--浏览器的语言设置会影响content-language，进而会导致一些font-family书写错误的网页出现字体混乱。</p>

<p>但是问题没有结束，为什么有的响应头有content-language信息，有的响应头又没有呢？</p>

<p>还有，试用了node的Express框架，故意把<code>font-family</code>写成<code>arial,sans-serif,simsun</code>，浏览器渲染的字体为<code>stheiti</code>，并不是日文字体，而是
Mac下Chrome默认的字体。响应头里也没有content-language的信息。究竟是后端的什么东西影响了呢？</p>

  </article>
  <!-- 多说评论框 -->

<div class="ds-thread" data-thread-key="/articles/puzzle-unsolved"
     data-title="一个尚未解决的问题 - 漫漫前端路"
     data-url="//articles/puzzle-unsolved/">
</div>

</div>

      </article>
    </div>
  </div>
  <footer class="site-footer">

  <div class="wrapper">

    <span>&copy; 2015 . Powered by
      <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a>.
    </span>


  </div>

</footer>
<!-- Baidu Analysis -->
<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?c8cbf7f57c14536e175a61dc20887032";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>
<!-- Google Analysis -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58181454-1', 'auto');
  ga('send', 'pageview');

</script>
<script src="/assets/js/main.js" type="text/javascript"></script>

  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  
  <script type="text/javascript">
    var duoshuoQuery = {short_name:"polly343900"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
  
</body>

</html>

